\documentclass[12pt]{article}

%% Escrevendo em português:
\usepackage[brazil]{babel}
\usepackage[latin1]{inputenc} 
\usepackage[T1]{fontenc}
\usepackage{psfrag}
\usepackage{fullpage}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{epsfig}
\usepackage{epstopdf}
\usepackage{color}
\usepackage{caption}
\usepackage{subcaption}
\usepackage[section]{placeins}
\usepackage{float}
\usepackage{amsmath}

%%%%%%%%%%%%%%%%
\begin{document}
%%%%%%%%%%%%%%%%

\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

\center % Center everything on the page
 
%----------------------------------------------------------------------------------------
%	HEADING SECTIONS
%----------------------------------------------------------------------------------------

\textsc{\LARGE Universidade Estadual de Campinas}\\[0.5cm]
\textsc{\normalsize ES827A - Robótica Industrial}\\[0.2cm] % Major heading such as course name
\textsc{\normalsize Turma A}\\[0.2cm] % Minor heading such as course title

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------
\vspace {5cm}
{ \huge \bfseries Projeto Final - Dinâmica e cinemática do robô Puma560 }\\[0.4cm] % Title of your document
 
%----------------------------------------------------------------------------------------
%	AUTHOR SECTION
%----------------------------------------------------------------------------------------
\vspace {5cm}
\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\emph{Alunos:}\\
 \begin{tabbing}
 Augusto Miranda Garcia\hspace{1cm} \=  \= 104627 \\
 Guilherme de Oliveira Souza  \> 117093 \\
 \end{tabbing}
\end{flushleft}
\end{minipage}
\vspace {2cm}

\begin{minipage}{0.4\textwidth}
\begin{flushright} \large
\emph{Professor responsável:} \\
Dr. Ely Carneiro Paiva
\end{flushright}
\end{minipage}\\[2cm]

{\large \today}\\[3cm] % Date, change the \today to a set date if you want to be precise

\vfill % Fill the rest of the page with whitespace

\end{titlepage}



\tableofcontents
\clearpage

\section{Objetivo}
\begin{par}
	O objetivo desse relatório é apresentar o desenvolvimento dos conceitos apresentados em aula de robótica industrial nas atividades propostas para o projeto, sendo então concluído com questões sobre o assunto desenvolvido. É utilizado para tal o Robotics Toolbox, sendo usado o robô Puma560, já incluído na toolbox.
\end{par}

\begin{figure}[H]
\centering
\includegraphics [width=4in]{puma560.png}
\caption {Robô Puma560.}
\end{figure}

\section{Dinâmica}
\begin{par}
	Para a modelagem dinâmica do robô seguiu-se o capítulo 6 da tese fornecida no roteiro do projeto, com a ressalva de ter-se evitado o uso do simulink, sendo ao invés feita a chamada do robô e montagem do sistema diretamente em código, que pode ser encontrado nos anexos. Além disso, foi evitado o uso de atrito seco, que deixa as simulações muito lentas para o propósito desse relatório. Após a montagem, foram feitos testes em malha aberta e análise do equilíbrio de energia cinética do robô. 
\end{par}

\subsection{Simulações em malha aberta}
\begin{par}
As simulações em malha aberta foram feitas baseadas nos ângulos fornecidos pela tese. Para tal, foi primeiramente encontrado o torque necessário para manter o robô parado na posição final $q_f$, resistindo a força da gravidade. Então, o mesmo torque foi aplicado diretamente sobre o robô para assim observar se o robô se direciona até a posição final a partir de uma posição inicial. A posição final escolhida foi:
\end{par}

\begin{equation*}
	q_f = [0, \pi/2, -\pi/2, 0, 0, 0]
\end{equation*}

E as posições iniciais simuladas foram, respectivamente:

\begin{align*}
	q_{0a} = & [ 0, 0 , 0, 0, 0, 0]\\
	q_{0b} = & [ 0, \pi , -\pi/2, 0, 0, 0]\\
	q_{0c} = & [ 0, \pi/2 , -\pi/2, 0, 0, 0]\\
	q_{0d} = & [ 0, \pi/2+0.05 , -\pi/2, 0, 0, 0]
\end{align*}

\begin{par}
Os respectivos movimentos estão demonstrados na figura \ref{fig:simAberta} abaixo. Observe que, nas figuras \ref{fig:simAberta01} \ref{fig:simAberta02} e \ref{fig:simAberta04}, a posição $q_2$(ou $q_f[2]$) não vai até a posição final $\pi/2$, indo ao invés para a posição $3\pi/2$. Ao verificar a posição do robô, notou-se que ela é equivalente a posição final do robô em $\pi/2$, podendo-se concluir de que não houve erros no fim para essa estabilização.
\end{par}

\begin{figure}[H]
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_01.png}
  \caption{Simulação para $q_{0a}$}
  \label{fig:simAberta01}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_02.png}
  \caption{Simulação para $q_{0b}$}
  \label{fig:simAberta02}
\end{subfigure}

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_03.png}
  \caption{Simulação para $q_{0c}$}
  \label{fig:simAberta03}
\end{subfigure}%
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_04.png}
  \caption{Simulação para $q_{0d}$}
  \label{fig:simAberta04}
\end{subfigure}

\caption{Simulação em malha aberta para as respectivas condições iniciais com o torque para a condição final $q_f$ aplicado.}
\label{fig:simAberta}
\end{figure}

\begin{par}
Observou-se também que houveram oscilações indesejáveis com a simulação em malha aberta, natural já que o sistema não possui uma realimentação. Mas no fim, o robô aparenta ser estável em malha aberta.
\end{par}


\subsection{Simulações em malha aberta para análise da energia cinética}

\begin{par}
	Para efetuar-se a análise da variação de energia cinética do sistema, foi seguido o procedimento apresentado na tese. Inicialmente, o robô é colocado em suas condição inicial, sendo então solto e deixado balançando livremente. No caso, é esperado que ele tenha um comportamento parecido com o de um  pêndulo duplo, devido a suas características físicas. para este ensaio, foram estudadas duas variâncias no experimento, são elas uma variação da posição inicial e o experimento foi executado com e sem atrito viscoso. 
\end{par}
\begin{par}
	Para gerar a curva da energia cinética é utilizada a equação a seguir: 	
\end{par}
\begin{equation*}
	K = \frac{1}{2}\dot{q}^T M(q) \dot{q}
\end{equation*}

\begin{par}
Note que a matriz de inércia varia, como esperado, de acordo com a posição espacial atual do robô. As curvas de posição e variação da energia cinética para cada um dos casos definidos podem ser observadas nas figuras \ref{fig:simEnergia01}, \ref{fig:simEnergia02}, \ref{fig:simEnergia03} e \ref{fig:simEnergia04}.
\end{par}

\begin{par}
Ao se analisar as figuras \ref{fig:simEnergia01} e \ref{fig:simEnergia02}, pode-se notar que o robô cai ao repouso e rapidamente se estabiliza na posição com menos energia cinética possível (braços do robô para baixo). A estabilização ocorre rapidamente devido ao atrito viscoso, em menos de dez segundos, e nao notou-se diferenças visíveis para a pequena variação da posição inicial. Isso ocorre pois o sistema é simples, com poucos graus de liberdades para esse caso, e consequentemente não muito caótico.
\end{par}

\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_05.png}
  \caption{Variação da posição}
  \label{fig:simEnergia01a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_06.png}
  \caption{Variação da energia cinética}
  \label{fig:simEnergia01b}
\end{subfigure}

\caption{Simulação com atrito viscoso para posição inicial $q_0 = [0, 0, 0, 0, 0, 0]$.}
\label{fig:simEnergia01}
\end{figure}

\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_07.png}
  \caption{Variação da posição}
  \label{fig:simEnergia02a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_08.png}
\caption{Variação da energia cinética}
  \label{fig:simEnergia02b}
\end{subfigure}

\caption{Simulação com atrito viscoso para posição inicial $q_0 = [0, 1e-6, 0, 0, 0, 0]$.}
\label{fig:simEnergia02}
\end{figure}

\begin{par}
Ao ser retirado o atrito do sistema, ele passa a se mover livremente, já que não há dissipação de energia, e fica oscilando entre seus graus de liberdade, como pode ser observado nas figuras \ref{fig:simEnergia03} e \ref{fig:simEnergia04}. A energia cinética, como esperado para esse caso, varia bastante. Também não se observou grandes mudanças com a pequena variação das condições iniciais neste caso.
\end{par}


\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_09.png}
  \caption{Variação da posição}
  \label{fig:simEnergia03a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_10.png}
  \caption{Variação da energia cinética}
  \label{fig:simEnergia03b}
\end{subfigure}

\caption{Simulação sem atrito viscoso para posição inicial $q_0 = [0, 0, 0, 0, 0, 0]$.}
\label{fig:simEnergia03}
\end{figure}

\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_11.png}
  \caption{Variação da posição}
  \label{fig:simEnergia04a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_12.png}
\caption{Variação da energia cinética}
  \label{fig:simEnergia04b}
\end{subfigure}

\caption{Simulação com atrito viscoso para posição inicial $q_0 = [0, 1e-6, 0, 0, 0, 0]$.}
\label{fig:simEnergia04}
\end{figure}

\subsection{Controle em malha fechada}
\begin{par}
	Para o controle em malha fechada, foi aplicado um controle PD com compensação a gravidade, como sugerido pela tese. Pode ser provado que, com a compensação da gravidade, pode-se tratar cada uma das juntas como um sistema SISO, e como tal cada uma das juntas recebe um controlador PD separadamente. Isso pode ser expresso como uma matriz diagonal das constantes de controle do sistema. 
\end{par}

\begin{par}
	Para desenvolver o controle do robô, segue-se então o seguinte modelo, que já inclui a compensação da gravidade:
\end{par}
\begin{equation*}
	M(q)\ddot{q}+C(q,\dot{q})\dot{q} = -K_p\tilde{q}-K_d\dot{q}
\end{equation*}

\begin{par}
	Foi então desenvolvido o código em Matlab respectivo a equação acima, e executada simulações de controle posicional para três posições diferentes, com diferentes configurações iniciais, apresentadas nas seções a seguir. O controlador PD utilizado foi o mesmo utilizado na tese, já que assim como apresentado não há a necessidade de ajustar seus valores, pois não são decisivos para manter o sistema assintoticamente estável. Os respectivos valores para as constantes estão apresentados a seguir.
\end{par}


\[
K_p =
\begin{pmatrix}
50 &  0  & 0 & 0 & 0 & 0\\
0 &  50  & 0 & 0 & 0 & 0\\
0 &  0  & 50 & 0 & 0 & 0\\
0 &  0  & 0 & 50 & 0 & 0\\
0 &  0  & 0 & 0 & 50 & 0\\
0 &  0  & 0 & 0 & 0 & 50
\end{pmatrix}
\]		

\[
K_d =
\begin{pmatrix}
20 &  0  & 0 & 0 & 0 & 0\\
0 &  20  & 0 & 0 & 0 & 0\\
0 &  0  & 20 & 0 & 0 & 0\\
0 &  0  & 0 & 20 & 0 & 0\\
0 &  0  & 0 & 0 & 20 & 0\\
0 &  0  & 0 & 0 & 0 & 20
\end{pmatrix}
\]		

\subsubsection{Simulação 1}

\begin{align*}
	q_{init} = & [ 0, 0 , 0, 0, 0, 0]^T\\
	\dot{q}_{init} = & [ 0, 0 , 0, 0, 0, 0]^T\\
	q_{ref} = & [ \pi/2, 0 , -\pi/2, \pi, \pi/2, -\pi]^T
\end{align*}

Os resultados da simulação podem ser vistos na figura \ref{}
\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_13.png}
  \caption{Resposta em malha fechada da posição, simulação 1}
  \label{fig:simLoop01a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_14.png}
\caption{Sinal de controle (torque) em malha fechada, simulação 1}
  \label{fig:simLoop01b}
\end{subfigure}
\caption{Respostas da simulação 1 em malha fechada.}
\label{fig:simLoop01}
\end{figure}

\subsubsection{Simulação 2}

\begin{align*}
	q_{init} = & [ 0, \pi , \pi/2, 0, 0, 0]^T\\
	\dot{q}_{init} = & [ 0, 0 , 0, 0, 0, 0]^T\\
	q_{ref} = & [ \pi, 0 , 0, \pi, -\pi/2, 0]^T
\end{align*}

Os resultados da simulação podem ser vistos na figura \ref{fig:simLoop02}.
\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_15.png}
  \caption{Resposta em malha fechada da posição, simulação 2}
  \label{fig:simLoop02a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_16.png}
\caption{Sinal de controle (torque) em malha fechada, simulação 2}
  \label{fig:simLoop02b}
\end{subfigure}
\caption{Respostas da simulação 2 em malha fechada.}
\label{fig:simLoop02}
\end{figure}

\subsubsection{Simulação 3}

\begin{align*}
	q_{init} = & [ 0, \pi/2 , -\pi/2, 0, 0, 0]^T\\
	\dot{q}_{init} = & [ 0, 0 , 0, 0, 0, 0]^T\\
	q_{ref} = & [ -\pi, \pi , -\pi, -\pi, -\pi/2, \pi]^T
\end{align*}

Os resultados da simulação podem ser vistos na figura \ref{fig:simLoop03}.
\begin{figure}[H]

\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_15.png}
  \caption{Resposta em malha fechada da posição, simulação 3}
  \label{fig:simLoop03a}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1.0\linewidth]{projeto_16.png}
\caption{Sinal de controle (torque) em malha fechada, simulação 3}
  \label{fig:simLoop03b}
\end{subfigure}
\caption{Respostas da simulação 3 em malha fechada.}
\label{fig:simLoop03}
\end{figure}

\subsubsection{Comentários}
\begin{par}
	Todas as referências passadas foram seguidas em menos de 2.5 segundos. A estabilidade assintótica também é visível, e pode-se observar que não há oscilações, que são normalmente indesejadas ao se trabalhar com robôs em geral. Como a compensação à gravidade já está incluída na equação correspondente, o torque tende a zero após chegar a posição correta.
\end{par}

\section{Cinemática}

\begin{par}
	Foi feita uma simulação em Matlab em que o robô desenha duas elipses, uma no plano XY e outra no plano ZY. As coordenadas desenhadas estão apresentadas a seguir. O movimento resultante do robô pode ser visto na simulação mandada em anexo a esse relatório. A trajetória final seguida pode ser vista na figura \ref{fig:trajetoria}
\end{par}

\begin{gather*}
	r_x = 0.5\\
	r_y = 0.7\\
	z = -0.5\\
	Elipse_1 = [r_x * cos(\theta), r_y * sin(\theta), z]
\end{gather*}

\begin{gather*}
	x = 0.5\\
	r_y = 0.5\\
	r_z = 0.25\\
	Elipse_2 = [x , r_y * sin(\theta), r_z * cos(\theta)]
\end{gather*}

\begin{figure}[H]
  \includegraphics[width=1.0\linewidth]{projeto2_01.png}
  \caption{Trajetória das elipses seguidas pelo robô.}
  \label{fig:trajetoria}

\end{figure}


\end{document}